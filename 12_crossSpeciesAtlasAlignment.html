<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit; background-repeat: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit; background-repeat: inherit; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571429rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit; background-repeat: inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>12_crossSpeciesAtlasAlignment</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='identifying-conserved-cell-type-specific-transcriptional-programs-in-hydra-and-clytia'><span>Identifying Conserved Cell-Type-Specific Transcriptional Programs in </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em></h1><p><span>This document covers our comparative analysis of the </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span> single-cell atlases. This analysis entailed using reciprocal principal component analysis to align the two datasets, quantifying overall transcriptional similarities between cell types using mutual nearest neighbor analysis, and identifying orthologs with conserved expression patterns.</span></p><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2"><a class="md-toc-inner" style="" href="#identifying-conserved-cell-type-specific-transcriptional-programs-in-hydra-and-clytia">Identifying Conserved Cell-Type-Specific Transcriptional Programs in <em>Hydra</em> and <em>Clytia</em></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n6"><a class="md-toc-inner" style="" href="#aligning-the-clytia-and-hydra-single-cell-atlases">Aligning the <em>Clytia</em> and <em>Hydra</em> Single-Cell Atlases</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n38"><a class="md-toc-inner" style="" href="#quantifying-transcriptional-similarities-between-clytia-and-hydra-cell-types">Quantifying Transcriptional Similarities Between <em>Clytia</em> and <em>Hydra</em> Cell Types</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n93"><a class="md-toc-inner" style="" href="#identifying-orthologous-genes-with-conserved-expression-patterns">Identifying Orthologous Genes with Conserved Expression Patterns</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n88"><a class="md-toc-inner" style="" href="#files-associated-with-this-document">Files Associated with This Document</a></span></p></div><p>&nbsp;</p><h2 id='aligning-the-clytia-and-hydra-single-cell-atlases'><span>Aligning the </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span> Single-Cell Atlases</span></h2><p><span>The process of aligning single cell datasets from different species uses the same approach as correcting for inter-sample batch effects. Essentially, we simply treat inter-species differences as (dramatic) batch effects. For this to be possible, the two datasets need to use the same gene IDs. In order to unambiguously link orthologous genes between </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span>, we limited our alignment analysis to only genes that had a one-to-one orthology between the two species, as determined through our Orthofinder analysis. We then simply converted the gene IDs for the </span><em><span>Clytia</span></em><span> data to their </span><em><span>Hydra</span></em><span> equivalents. </span></p><p><span>In the following code chunk, we identify one-to-one ortholog pairs, import and perform initial filtering on the </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span> gene expression matrices, convert the </span><em><span>Clytia</span></em><span> gene IDs to their </span><em><span>Hydra</span></em><span> equivalents, and concatenate all of the separate samples (15 </span><em><span>Hydra</span></em><span> libraries and one </span><em><span>Clytia</span></em><span> library) into a list of Seurat objects. </span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tidyverse</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rstudioapi</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">glmGamPoi</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">plotly</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">patchwork</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">plyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">SeuratDisk</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">cowplot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">fields</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">BiocNeighbors</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">networkD3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">reticulate</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#utility to convert transcript ID to gene ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t2g</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vapply</span>(<span class="cm-variable">x</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">y</span>) <span class="cm-variable">gsub</span>(<span class="cm-string">'HVAEP1_T(</span><span class="cm-string-2">\\</span><span class="cm-string">d+)[.]</span><span class="cm-string-2">\\</span><span class="cm-string">d'</span>,<span class="cm-string">'HVAEP1-G</span><span class="cm-string-2">\\</span><span class="cm-string">1'</span>,<span class="cm-variable">y</span>),<span class="cm-string">""</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setwd</span>(<span class="cm-variable">dirname</span>(<span class="cm-variable">getActiveDocumentContext</span>()<span class="cm-operator cm-dollar">$</span><span class="cm-variable">path</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import list of non-doublet Hydra cell IDs</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nonDub</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">'../dropSeqMapping/finalNonDub.txt'</span>)[,<span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import orthofinder results to identify one-to-one orthologs between clytia and hydra</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">'../../Orthofinder/Results_Sep15_1/Phylogenetic_Hierarchical_Orthogroups/N14.tsv'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[,<span class="cm-variable">c</span>(<span class="cm-string">'C_hemisphaerica'</span>,<span class="cm-string">'H_vulgarisAEP'</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#drop genes without orthologs in the other species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span> <span class="cm-operator">!=</span> <span class="cm-string">''</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span> <span class="cm-operator">!=</span> <span class="cm-string">''</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#drop genes that don't have one-to-one orthology</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[<span class="cm-operator">!</span>(<span class="cm-variable">grepl</span>(<span class="cm-string">','</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>) <span class="cm-operator">|</span> <span class="cm-variable">grepl</span>(<span class="cm-string">','</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>)),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">gsub</span>(<span class="cm-string">'HVAEP1_T(</span><span class="cm-string-2">\\</span><span class="cm-string">d+)[.].*'</span>,<span class="cm-string">'HVAEP1_G</span><span class="cm-string-2">\\</span><span class="cm-string">1'</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import data and convert</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#get list of hydra count matrix files (include path in name)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">readMats</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">list.files</span>(<span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-string">'../dropSeqMapping'</span>, <span class="cm-variable">pattern</span> <span class="cm-operator">=</span> <span class="cm-string">'dge.txt.gz'</span>, <span class="cm-variable">recursive</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">full.names</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#read in each individual read matrix, generate a separate seurat object for each, and do some initial filtering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">inAep</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">readMats</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">y</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-variable">x</span>,<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,<span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#get batch name from parent folder of read matrix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">libName</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">gsub</span>(<span class="cm-string">'[.]+</span><span class="cm-string-2">\\</span><span class="cm-string">/dropSeqMapping</span><span class="cm-string-2">\\</span><span class="cm-string">/(D</span><span class="cm-string-2">\\</span><span class="cm-string">d+[^</span><span class="cm-string-2">\\</span><span class="cm-string">/]+)</span><span class="cm-string-2">\\</span><span class="cm-string">/.*'</span>,<span class="cm-string">'</span><span class="cm-string-2">\\</span><span class="cm-string">1'</span>,<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#apply batch names to cell barcodes to prevent redundant barcodes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">colnames</span>(<span class="cm-variable">y</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">paste0</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">y</span>),<span class="cm-string">'-'</span>,<span class="cm-variable">libName</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#drop doublet cells</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">y</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">y</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">y</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">nonDub</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#only keep genes that have one-to-one orthology with clytia genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">y</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">y</span>[<span class="cm-variable">rownames</span>(<span class="cm-variable">y</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">t2g</span>(<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#initialize seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tmpDS</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">y</span>, <span class="cm-variable">project</span> <span class="cm-operator">=</span> <span class="cm-variable">libName</span>, <span class="cm-variable">min.cells</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#perform preliminary filtering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">subset</span>(<span class="cm-variable">tmpDS</span>, <span class="cm-variable">subset</span> <span class="cm-operator">=</span> <span class="cm-variable">nFeature_RNA</span> <span class="cm-operator">&gt;</span> <span class="cm-number">300</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nFeature_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-number">7500</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nCount_RNA</span> <span class="cm-operator">&gt;</span> <span class="cm-number">500</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nCount_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-number">75000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import raw count matrix for remapped clytia data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X_h5</span>(<span class="cm-string">'../cl/remap/raw_feature_bc_matrix.h5'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#drop genes without one-to-one orthology with Hydra genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cl</span>[<span class="cm-variable">rownames</span>(<span class="cm-variable">cl</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#convert clytia gene names to their hydra equivalents</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">cl</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">rownames</span>(<span class="cm-variable">cl</span>),<span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>, <span class="cm-variable">to</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>, <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import the original annotated clytia dataset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clPP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">'../cl/remap/annotatedCl.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#remove any clytia cells that weren't in the original publication</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cl</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">cl</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">clPP</span>@<span class="cm-variable">meta.data</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-variable">clPP</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">cl</span>, <span class="cm-variable">project</span> <span class="cm-operator">=</span> <span class="cm-string">'clDS'</span>, <span class="cm-variable">min.cells</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">cl</span>, <span class="cm-variable">nFeature_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-number">4000</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nCount_RNA</span> <span class="cm-operator">&gt;</span> <span class="cm-number">500</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nCount_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-number">100000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#combine clytia object with list of hydra objects</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">inAep</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">append</span>(<span class="cm-variable">aepCl</span>,<span class="cm-variable">cl</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-variable">inAep</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 2046px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2046px;"></div></div></div></pre><p><span>We then performed standard dataset integration using reciprocal PCA analysis as implemented through Seurat. Following integration we performed PCA on the aligned dataset. </span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#normalize data using SCTransform</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">aepCl</span>, <span class="cm-variable">FUN</span> <span class="cm-operator">=</span> <span class="cm-variable">SCTransform</span>, <span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-string">"glmGamPoi"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#integrate data (both across batches and across species) using reciprocal pca</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">features</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SelectIntegrationFeatures</span>(<span class="cm-variable">aepCl</span>,<span class="cm-variable">assay</span><span class="cm-operator">=</span><span class="cm-variable">rep</span>(<span class="cm-string">'SCT'</span>,<span class="cm-variable">length</span>(<span class="cm-variable">aepCl</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">PrepSCTIntegration</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">aepCl</span>, <span class="cm-variable">anchor.features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>,<span class="cm-variable">assay</span><span class="cm-operator">=</span><span class="cm-variable">rep</span>(<span class="cm-string">'SCT'</span>,<span class="cm-variable">length</span>(<span class="cm-variable">aepCl</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">X</span> <span class="cm-operator">=</span> <span class="cm-variable">aepCl</span>, <span class="cm-variable">FUN</span> <span class="cm-operator">=</span> <span class="cm-variable">RunPCA</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">'SCT'</span>, <span class="cm-variable">npcs</span> <span class="cm-operator">=</span> <span class="cm-number">50</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dsAnchors</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindIntegrationAnchors</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">aepCl</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"SCT"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">anchor.features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">50</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"rpca"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">k.anchor</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-variable">aepCl</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gc</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">IntegrateData</span>(<span class="cm-variable">anchorset</span> <span class="cm-operator">=</span> <span class="cm-variable">dsAnchors</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"SCT"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">50</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-variable">dsAnchors</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gc</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#determining the dimensionality of the data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">npcs</span> <span class="cm-operator">=</span> <span class="cm-number">80</span>,<span class="cm-variable">verbose</span><span class="cm-operator">=</span><span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ElbowPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">ndims</span> <span class="cm-operator">=</span> <span class="cm-number">80</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 638px;"></div><div class="CodeMirror-gutters" style="display: none; height: 638px;"></div></div></div></pre><p><img src="resources/integratedElbow.png" referrerpolicy="no-referrer" alt="integratedElbow"></p><p><span>We then performed Louvain clustering and UMAP dimensional reduction using 30 PCs. We then visualized the clustering results using the UMAP plot.</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#generate UMAP projection and perform louvain clustering</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ndUse</span><span class="cm-operator">=</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-variable">ndUse</span>, <span class="cm-variable">min.dist</span> <span class="cm-operator">=</span> <span class="cm-number">0.18</span>,<span class="cm-variable">spread</span> <span class="cm-operator">=</span> <span class="cm-number">0.2</span>, <span class="cm-variable">seed.use</span> <span class="cm-operator">=</span> <span class="cm-number">4321</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindNeighbors</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-variable">ndUse</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">0.4</span>, <span class="cm-variable">graph.name</span> <span class="cm-operator">=</span> <span class="cm-string">'integrated_snn'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="resources/initIntegratedUMAP.png" referrerpolicy="no-referrer" alt="initIntUMAP"></p><p><span>We also split the plot by species to see the contribution of each species to different cell populations</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">grepl</span>(<span class="cm-string">'^D'</span>,<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.ident</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span>[<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-variable">T</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">'AEP'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span>[<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'FALSE'</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">'Cl'</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="resources/initIntUMAPbySpec.png" referrerpolicy="no-referrer" alt="initUmapBySpec"></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="resources/initIntUMAPsplitSpec.png" referrerpolicy="no-referrer" alt="initIntUMAPsplitSpec"></p><p>&nbsp;</p><p><span>To determine if our integrated dataset was properly aligning homologous cell types in the two species, we imported the cell annotations from the unintegrated atlases for each species. Specifically, we used the cell type annotations from our analysis of the AEP-mapped </span><em><span>Hydra</span></em><span> atlas (described in </span><code>05_hydraAtlasReMap.md</code><span>) and the annotations from the original </span><em><span>Clytia</span></em><span> atlas publication.</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">####Bring in curated cell identity annotations####</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clPP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">'../cl/remap/annotatedCl.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">'../dropSeqMapping/nonDubLabeledSeurat.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rbind</span>(<span class="cm-variable">data.frame</span>(<span class="cm-variable">ID</span><span class="cm-operator">=</span><span class="cm-variable">colnames</span>(<span class="cm-variable">clPP</span>), <span class="cm-variable">curatedIdent</span> <span class="cm-operator">=</span> <span class="cm-variable">as.character</span>(<span class="cm-variable">clPP</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">annos</span>),<span class="cm-variable">curatedIdentSub</span><span class="cm-operator">=</span><span class="cm-variable">as.character</span>(<span class="cm-variable">clPP</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">annosSub</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data.frame</span>(<span class="cm-variable">ID</span><span class="cm-operator">=</span><span class="cm-variable">colnames</span>(<span class="cm-variable">ds</span>), <span class="cm-variable">curatedIdent</span> <span class="cm-operator">=</span> <span class="cm-variable">as.character</span>(<span class="cm-variable">ds</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span>),<span class="cm-variable">curatedIdentSub</span> <span class="cm-operator">=</span> <span class="cm-variable">as.character</span>(<span class="cm-variable">ds</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#only keep cells that made it into the integrated object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span>[<span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ID</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">aepCl.int</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#reorder cells so they are the same order as the integrated metadata table</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">annotTab</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span>[<span class="cm-variable">colnames</span>(<span class="cm-variable">aepCl.int</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#colors for cluster plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clustPal</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"#45adec"</span>,<span class="cm-string">"#cbee2f"</span>,<span class="cm-string">"#d565f5"</span>,<span class="cm-string">"#85e538"</span>,<span class="cm-string">"#f452cd"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#57e958"</span>,<span class="cm-string">"#997cfb"</span>,<span class="cm-string">"#eadc25"</span>,<span class="cm-string">"#528efb"</span>,<span class="cm-string">"#abd533"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#d07be8"</span>,<span class="cm-string">"#65c737"</span>,<span class="cm-string">"#a585f0"</span>,<span class="cm-string">"#54e170"</span>,<span class="cm-string">"#e27cd1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#4eb13a"</span>,<span class="cm-string">"#f2699f"</span>,<span class="cm-string">"#3ee698"</span>,<span class="cm-string">"#f76748"</span>,<span class="cm-string">"#3be6ea"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#f57417"</span>,<span class="cm-string">"#3295e9"</span>,<span class="cm-string">"#d0cc36"</span>,<span class="cm-string">"#6e8de9"</span>,<span class="cm-string">"#def469"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#7d9af7"</span>,<span class="cm-string">"#95ca42"</span>,<span class="cm-string">"#47a2f7"</span>,<span class="cm-string">"#e8b027"</span>,<span class="cm-string">"#2499d7"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#e8802b"</span>,<span class="cm-string">"#9d94e5"</span>,<span class="cm-string">"#a1f078"</span>,<span class="cm-string">"#db93d2"</span>,<span class="cm-string">"#83ce5a"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#f2686c"</span>,<span class="cm-string">"#51dbb4"</span>,<span class="cm-string">"#e77f4a"</span>,<span class="cm-string">"#56c88d"</span>,<span class="cm-string">"#e87c86"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#6bc565"</span>,<span class="cm-string">"#e8886e"</span>,<span class="cm-string">"#82e596"</span>,<span class="cm-string">"#c98b23"</span>,<span class="cm-string">"#a6f4b4"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#c78b3c"</span>,<span class="cm-string">"#5ab267"</span>,<span class="cm-string">"#eaaa43"</span>,<span class="cm-string">"#99cd86"</span>,<span class="cm-string">"#df9f64"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#ade486"</span>,<span class="cm-string">"#e8aa59"</span>,<span class="cm-string">"#91a824"</span>,<span class="cm-string">"#d6e58f"</span>,<span class="cm-string">"#b39420"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#cce679"</span>,<span class="cm-string">"#b0953a"</span>,<span class="cm-string">"#efda63"</span>,<span class="cm-string">"#8eac57"</span>,<span class="cm-string">"#d8b644"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#94af45"</span>,<span class="cm-string">"#dcbd61"</span>,<span class="cm-string">"#aaa126"</span>,<span class="cm-string">"#ceca7b"</span>,<span class="cm-string">"#c9ca4d"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"#a4a154"</span>,<span class="cm-string">"#e8de7a"</span>,<span class="cm-string">"#afa746"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set.seed</span>(<span class="cm-number">5321</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clustPal</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">clustPal</span>[<span class="cm-variable">sample</span>(<span class="cm-variable">length</span>(<span class="cm-variable">clustPal</span>))]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#plot using broad cluster labels from clytia paper</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'curatedIdent'</span>,<span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">clustPal</span>,<span class="cm-variable">pt.size</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 946px;"></div><div class="CodeMirror-gutters" style="display: none; height: 946px;"></div></div></div></pre><p><img src="resources/intUMAPcuratedIdentBroad.png" referrerpolicy="no-referrer" alt="intUMAPcuratedIDbroad"></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#plot using more granular cluster labels from clytia paper</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a bit crowded)</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'curatedIdentSub'</span>,<span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>, <span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">clustPal</span>,<span class="cm-variable">pt.size</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><img src="resources/intUMAPcuratedIdentFine.png" referrerpolicy="no-referrer" alt="intUMAPcuratedIDbroad"></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#a very course level of clustering for the integrated data just to group together broad cell types</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">0.05</span>, <span class="cm-variable">graph.name</span> <span class="cm-operator">=</span> <span class="cm-string">'integrated_snn'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'integrated_snn_res.0.05'</span>,<span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,<span class="cm-variable">pt.size</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#save object for later</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">saveRDS</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-string">'aepClInt.rds'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="resources/intUMAPbroad.png" referrerpolicy="no-referrer" alt="intUMAPbroad"></p><p><span>Based on these plots, our integration was successful, as homologous cell types colocalize in the UMAP and are clustered together by the Louvain algorithm.</span></p><h2 id='quantifying-transcriptional-similarities-between-clytia-and-hydra-cell-types'><span>Quantifying Transcriptional Similarities Between </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span> Cell Types</span></h2><p><span>Although UMAPs can give an indication of similarity between different cells, it is not a quantitative way of assessing similarity. To assess similarity quantitatively, we adopted the alignment score metric proposed by Tarashansky et al. (2021). </span></p><p><span>To generate this score, the 30 nearest inter-species neighbors for each cell in the aligned principal component space are identified. Then, for a given cell type in one species, the number of nearest cross-species neighbors that were from each cell type in the other species is tabulated. The final alignment score is defined as the portion of total cross-species pairs for a cell type in one species that belonged to a particular cell type in another species. Thus, a higher alignment score indicates that the two cell types being compared shared a higher number of neighbors in the aligned PC space. </span></p><p><span>Because we were interested in identifying possible similarities between neuronal subtypes in </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span>, and because the whole-animal version of the </span><em><span>Clytia</span></em><span> atlas did not resolve individual neuronal subtypes, we incorporated cell type labels from the </span><em><span>Clytia</span></em><span> neuronal subclustering analysis before performing the alignment quantification. </span></p><p><span>To do this we first had to download the neuronal sub clustering object (available </span><a href='https://data.caltech.edu/records/1804'><span>here</span></a><span>) and convert it to a Seurat object.</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#convert neuronal subclustering object from clytia paper into seurat object</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#only needs to be run once</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">use_condaenv</span>(<span class="cm-string">"rScanpy"</span>, <span class="cm-variable">required</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">import</span>(<span class="cm-string">"scanpy"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">adata</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sc</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">read_h5ad</span>(<span class="cm-string">'../cl/remap/neuron_subpops_fs.h5ad'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">exprs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">t</span>(<span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">exprs</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">obs_names</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">to_list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">exprs</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">var_names</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">to_list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Create the Seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">seurat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">exprs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Set the expression assay</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">seurat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SetAssayData</span>(<span class="cm-variable">seurat</span>, <span class="cm-string">"data"</span>, <span class="cm-variable">exprs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Add observation metadata</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">seurat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">AddMetaData</span>(<span class="cm-variable">seurat</span>, <span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">obs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Add embedding</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">embedding</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">obsm</span>[<span class="cm-string">"X_umap"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">embedding</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">adata</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">obs_names</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">to_list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">embedding</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"umap_1"</span>, <span class="cm-string">"umap_2"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">seurat</span>[[<span class="cm-string">"umap"</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateDimReducObject</span>(<span class="cm-variable">embedding</span>, <span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-string">"umap_"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#save converted object to save time later</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">saveRDS</span>(<span class="cm-variable">seurat</span>,<span class="cm-string">'annotatedNeuroCl.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clN</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">seurat</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-variable">seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clN</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">'annotatedNeuroCl.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">clN</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'louvain_neur'</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 704px;"></div><div class="CodeMirror-gutters" style="display: none; height: 704px;"></div></div></div></pre><p><img src="resources/clNeuroUMAP.png" referrerpolicy="no-referrer" alt="clNeuroUMAP"></p><p><span>We then updated the cell labels for </span><em><span>Clytia</span></em><span> neurons using the higher resolution cluster labels from the neuron sub-clustering</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#for neuronal cells, replace the cell labels from the</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#from the whole-animal analysis with the labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#from the neuronal subcluster analysis</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span>[<span class="cm-operator">!</span>(<span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ID</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">clN</span>)),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rbind</span>(<span class="cm-variable">data.frame</span>(<span class="cm-variable">ID</span><span class="cm-operator">=</span><span class="cm-variable">colnames</span>(<span class="cm-variable">clN</span>), <span class="cm-variable">curatedIdent</span> <span class="cm-operator">=</span> <span class="cm-string">'Neuron'</span>,<span class="cm-variable">curatedIdentSub</span><span class="cm-operator">=</span><span class="cm-variable">paste0</span>(<span class="cm-string">'neuro_'</span>,<span class="cm-variable">as.character</span>(<span class="cm-variable">clN</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">louvain_neur</span>))),<span class="cm-variable">annotTab</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span>[<span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ID</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">aepCl.int</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">annotTab</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annotTab</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span>[<span class="cm-variable">colnames</span>(<span class="cm-variable">aepCl.int</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">annotTab</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p><span>We then extracted the principal component cell scores from the integrated seurat object and separated them by species. We then performed a mutual nearest neighbor analysis to identify the </span><em><span>Clytia</span></em><span> cells that was most similar to each </span><em><span>Hydra</span></em><span> cell. We then converted these cell IDs to cell type labels and tabulated the number of cells from each </span><em><span>Clytia</span></em><span> cell type associated with each </span><em><span>Hydra</span></em><span> cell type. Finally, we used these values to generate a Sankey diagram showing all alignment scores greater than 0.05 (indicating that greater than 5% of all nearest neighbors for a </span><em><span>Hydra</span></em><span> cell type were made up of a given </span><em><span>Clytia</span></em><span> cell type).</span></p><p><span>(</span><em><span>snippet from 01_alignment/aepCl.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#extract cell score for principal components from seurat object</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pcSpace</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aepCl.int</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pca</span>@<span class="cm-variable">cell.embeddings</span>[,<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">80</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#split cell PC scores by species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pcSpace.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pcSpace</span>[<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'AEP'</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pcSpace.c</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pcSpace</span>[<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'Cl'</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#specify the number of nearest neighbors to use for MNN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kUse</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">30</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#find nearest neighbors for all cells in aligned PC space</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">findMutualNN</span>(<span class="cm-variable">pcSpace.a</span>,<span class="cm-variable">pcSpace.c</span>, <span class="cm-variable">k1</span> <span class="cm-operator">=</span> <span class="cm-variable">kUse</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#get the cross-species neighbor pair cell IDs</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">AEP</span><span class="cm-operator">=</span><span class="cm-variable">mnnRes</span>[[<span class="cm-number">1</span>]],<span class="cm-variable">Cl</span><span class="cm-operator">=</span><span class="cm-variable">mnnRes</span>[[<span class="cm-number">2</span>]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">AEP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.a</span>)[<span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">AEP</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.c</span>)[<span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Cl</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.orig</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mnnRes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#convert neighbor pair cell IDs to cell type labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Aepclust</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">AEP</span>,<span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span>), <span class="cm-variable">to</span> <span class="cm-operator">=</span> <span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span>, <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ClClust</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Cl</span>,<span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span>), <span class="cm-variable">to</span> <span class="cm-operator">=</span> <span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span>, <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">mnnRes</span>,<span class="cm-string">'mnnRes.csv'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#split pair assignments by AEP cell</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">split</span>(<span class="cm-variable">mnnRes</span>, &nbsp;<span class="cm-variable">mnnRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Aepclust</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#for a given hydra cell type, calculate the portion of</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#it's neighbors made up by each clytia cell type</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">mnnRes.a</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">table</span>(<span class="cm-variable">x</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ClClust</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">res</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">score</span> <span class="cm-operator cm-arrow">&lt;-</span> (<span class="cm-variable">res</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Freq</span><span class="cm-operator">/</span><span class="cm-variable">length</span>(<span class="cm-variable">unique</span>(<span class="cm-variable">x</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">AEP</span>)))<span class="cm-operator">/</span><span class="cm-variable">kUse</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">res</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#set a minimum score cutoff of 0.05</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">mnnRes.a</span>,<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">x</span>[<span class="cm-variable">x</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">score</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0.05</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#drop cell types without any meaningful alignment</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mnnRes.a</span>[<span class="cm-variable">sapply</span>(<span class="cm-variable">mnnRes.a</span>,<span class="cm-variable">nrow</span>) <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#add a column with the hydra cell ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(to keep track of stuff when the list is collapsed)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">length</span>(<span class="cm-variable">mnnRes.a</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mnnRes.a</span>[[<span class="cm-variable">x</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">df</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">aepClust</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">names</span>(<span class="cm-variable">mnnRes.a</span>)[<span class="cm-variable">x</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">df</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mnnRes.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">do.call</span>(<span class="cm-variable">rbind</span>,<span class="cm-variable">mnnRes.a</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#these objects are formatted in a particular way to fit the input requirements</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#of the sankey plotting funciton</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#this object simply lists all of the cell types in the analysis (both clytia and hydra)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nodeDf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-variable">unique</span>(<span class="cm-variable">c</span>(<span class="cm-variable">as.character</span>(<span class="cm-variable">mnnRes.a</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Var1</span>),<span class="cm-variable">mnnRes.a</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">aepClust</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#need to manually set the order so that the resulting plot has a logical order</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nodeDf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">nodeDf</span>[<span class="cm-variable">c</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-number">4</span>,<span class="cm-number">5</span>,<span class="cm-number">2</span>,<span class="cm-number">12</span>,<span class="cm-number">13</span>,<span class="cm-number">14</span>,<span class="cm-number">11</span>,<span class="cm-number">16</span>,<span class="cm-number">15</span>,<span class="cm-number">17</span>,<span class="cm-number">22</span>,<span class="cm-number">10</span>,<span class="cm-number">6</span>,<span class="cm-number">20</span>,<span class="cm-number">8</span>,<span class="cm-number">7</span>,<span class="cm-number">9</span>,<span class="cm-number">21</span>,<span class="cm-number">18</span>,<span class="cm-number">19</span>,<span class="cm-number">23</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">24</span>,<span class="cm-number">27</span>,<span class="cm-number">26</span>,<span class="cm-number">28</span>,<span class="cm-number">30</span>,<span class="cm-number">29</span>,<span class="cm-number">46</span>,<span class="cm-number">25</span>,<span class="cm-number">34</span>,<span class="cm-number">36</span>,<span class="cm-number">35</span>,<span class="cm-number">37</span>,<span class="cm-number">39</span>,<span class="cm-number">38</span>,<span class="cm-number">47</span>,<span class="cm-number">41</span>,<span class="cm-number">33</span>,<span class="cm-number">43</span>,<span class="cm-number">48</span>,<span class="cm-number">44</span>,<span class="cm-number">31</span>,<span class="cm-number">32</span>,<span class="cm-number">45</span>,<span class="cm-number">49</span>,<span class="cm-number">40</span>,<span class="cm-number">42</span>,<span class="cm-number">50</span>),,<span class="cm-variable">drop</span><span class="cm-operator">=</span><span class="cm-variable">F</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#this object specifies the cell type pairs and the alignment score between them</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkDf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">source</span> <span class="cm-operator">=</span> <span class="cm-variable">mnnRes.a</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Var1</span>, <span class="cm-variable">target</span><span class="cm-operator">=</span><span class="cm-variable">mnnRes.a</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">aepClust</span>, <span class="cm-variable">value</span><span class="cm-operator">=</span><span class="cm-variable">mnnRes.a</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">score</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#these encode the index for the cell type in the nodeDF object (zero indexed)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">IDsource</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">match</span>(<span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">source</span>, <span class="cm-variable">nodeDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">name</span>)<span class="cm-operator">-</span><span class="cm-number">1</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">IDtarget</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">match</span>(<span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">target</span>, <span class="cm-variable">nodeDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">name</span>)<span class="cm-operator">-</span><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#plot using plotly sankey plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_ly</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">type</span> <span class="cm-arg-is">=</span> <span class="cm-string">"sankey"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">orientation</span> <span class="cm-arg-is">=</span> <span class="cm-string">"h"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">node</span> <span class="cm-arg-is">=</span> <span class="cm-builtin">list</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">nodeDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">name</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-variable">clustPal</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">48</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pad</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">thickness</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">line</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-string">"black"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">link</span> <span class="cm-arg-is">=</span> <span class="cm-builtin">list</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">source</span> <span class="cm-operator">=</span> <span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">IDsource</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">target</span> <span class="cm-operator">=</span> <span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">IDtarget</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">value</span> <span class="cm-operator">=</span> &nbsp;<span class="cm-variable">linkDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 2134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2134px;"></div></div></div></pre><p><img src="resources/crossSankey.png" alt="crossSankey" style="zoom:33%;" /></p><p><span>As an alternative approach to visualize and evaluate the degree of transcriptional similarity between </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span> cells, we also calculated a distance metric that captured how different the overall transcriptional profiles of cells from one species were when compared to their most similar transcriptional neighbors from the other species. To generate this metric, we calculated the average distance to the 30 nearest cross-species nearest neighbors in aligned principal component space for each cell. We then plotted these values on the cross-species UMAP to visually link these distance values to cell type annotations.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#get distance between mnn pairs</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#make distance matrix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pcSpace.a</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pcSpace</span>[<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'AEP'</span>,<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">80</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pcSpace.c</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pcSpace</span>[<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'Cl'</span>,<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">80</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cDist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rdist</span>(<span class="cm-variable">pcSpace.a</span>,<span class="cm-variable">pcSpace.c</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">cDist</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.a</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">cDist</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.c</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#for every hydra cell, get the average distance for the 30 closest clytia cells</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepDist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">vapply</span>(<span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.a</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cDist</span>[<span class="cm-variable">x</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dists</span>[<span class="cm-variable">order</span>(<span class="cm-variable">dists</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mean</span>(<span class="cm-variable">dists</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">dists</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}, <span class="cm-variable">numeric</span>(<span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#for every clytia cell, get the average distance for the 30 closest hydra cells</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clDist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">vapply</span>(<span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.c</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cDist</span>[,<span class="cm-variable">x</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dists</span>[<span class="cm-variable">order</span>(<span class="cm-variable">dists</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">dists</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mean</span>(<span class="cm-variable">dists</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">dists</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}, <span class="cm-variable">numeric</span>(<span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dist.df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">cellID</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.a</span>),<span class="cm-variable">rownames</span>(<span class="cm-variable">pcSpace.c</span>)), <span class="cm-variable">dist</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-variable">aepDist</span>,<span class="cm-variable">clDist</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dist.df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dist.df</span>[<span class="cm-variable">match</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">aepCl.int</span>),<span class="cm-variable">dist.df</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cellID</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dist.df</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdent</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">dist.df</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">'crossSpecDist.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">dist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dist.df</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">dist</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-string">'dist'</span>,<span class="cm-variable">order</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 880px;"></div><div class="CodeMirror-gutters" style="display: none; height: 880px;"></div></div></div></pre><p><img src="resources/crossSpecDistance.png" alt="crossSpecDistance" style="zoom:33%;" /></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-string">'dist'</span>, <span class="cm-variable">order</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">'species'</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">0.4</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="resources/crossSpecDistanceSplit.png" referrerpolicy="no-referrer" alt="crossSpecDistanceSplit"></p><p><span>We also summarized the distance metric results using a boxplot that grouped distance scores by cell type in each species. The first boxplot presents distances for </span><em><span>Hydra</span></em><span> cell types.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plotDf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aepCl.int</span>@<span class="cm-variable">meta.data</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plotFacts</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">levels</span>(<span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">factOrder</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"I_ISC"</span>,<span class="cm-string">"I_FemGC"</span>,<span class="cm-string">"I_MaleGC"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_GlProgen"</span>,<span class="cm-string">"I_ZymoGl"</span>,<span class="cm-string">"I_GranGl"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_SpumMucGl"</span>,<span class="cm-string">"I_Neuro"</span>,<span class="cm-string">"I_Ec1/5N"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_Ec1N"</span>,<span class="cm-string">"I_Ec2N"</span>,<span class="cm-string">"I_Ec3N"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_Ec4N"</span>,<span class="cm-string">"I_En1N"</span>,<span class="cm-string">"I_En2N"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_En3N"</span>,<span class="cm-string">"I_EarlyNem"</span>,<span class="cm-string">"I_DesmoNB"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_StenoNB"</span>,<span class="cm-string">"I_IsoNB"</span>,<span class="cm-string">"I_DesmoNC"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"I_StenoNC"</span>,<span class="cm-string">"I_IsoNC"</span>,<span class="cm-string">"Ec_BasalDisk"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Ec_Peduncle"</span>,<span class="cm-string">"Ec_BodyCol/SC"</span>,<span class="cm-string">"Ec_Head"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Ec_Tentacle"</span>,<span class="cm-string">"En_Foot"</span>,<span class="cm-string">"En_BodyCol/SC"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"En_Head"</span>,<span class="cm-string">"En_Tentacle"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"i-Cells"</span>,<span class="cm-string">"Very Early Oocytes"</span>,<span class="cm-string">"Small Oocytes"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Medium Oocytes"</span>,<span class="cm-string">"Gland Cells-A"</span>,<span class="cm-string">"Gland Cells-B"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Gland Cells-C"</span>,<span class="cm-string">"Gland Cells-D"</span>,<span class="cm-string">"Gland Cells-E"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"neuro_0"</span>,<span class="cm-string">"neuro_1"</span>,<span class="cm-string">"neuro_2"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"neuro_3"</span>,<span class="cm-string">"neuro_4"</span>,<span class="cm-string">"neuro_5"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"neuro_6"</span>,<span class="cm-string">"neuro_7"</span>,<span class="cm-string">"neuro_8"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"neuro_9"</span>,<span class="cm-string">"neuro_10"</span>,<span class="cm-string">"neuro_11"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"neuro_12"</span>,<span class="cm-string">"neuro_13"</span>,<span class="cm-string">"neuro_14"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Nematocyte Precursors"</span>,<span class="cm-string">"Early Nematoblasts"</span>,<span class="cm-string">"Mid Nematoblasts"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Late Nematoblasts"</span>,<span class="cm-string">"Differentiating Nematocytes"</span>,<span class="cm-string">"Terminal Differentiating Nematocytes"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Mature Nematocytes"</span>,<span class="cm-string">"Exumbrella Epidermis"</span>,<span class="cm-string">"Manubrium Epidermis"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Gonad Epidermis"</span>,<span class="cm-string">"Tentacle Epidermis"</span>,<span class="cm-string">"Tentacle GFP Cells"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Radial Smooth Muscles"</span>,<span class="cm-string">"Striated Muscle of Subumbrella"</span>,<span class="cm-string">"Striated Muscle of Velum"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"Endodermal Plate"</span>,<span class="cm-string">"GastroDigestive-A"</span>,<span class="cm-string">"GastroDigestive-B"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"GastroDigestive-C"</span>,<span class="cm-string">"GastroDigestive-D"</span>,<span class="cm-string">"GastroDigestive-E"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"GastroDigestive-F"</span>,<span class="cm-string">"Tentacle Bulb Distal Gastroderm"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">curatedIdentSub</span>, <span class="cm-variable">levels</span> <span class="cm-operator">=</span> <span class="cm-variable">factOrder</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>(<span class="cm-variable">plotDf</span>[<span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'AEP'</span>,],<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">curatedIdentSub</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">dist</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">curatedIdentSub</span>)) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_boxplot</span>() <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#geom_jitter(height = 0, width = 0.1, size = 0.1,alpha=0.4) +</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme_bw</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme</span>(<span class="cm-variable">legend.position</span><span class="cm-operator">=</span><span class="cm-string">"none"</span>) <span class="cm-operator">+</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_flip</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 924px;"></div><div class="CodeMirror-gutters" style="display: none; height: 924px;"></div></div></div></pre><p><img src="resources/hvDistBox.png" alt="hvDistBox" style="zoom:25%;" /></p><p><span>The second boxplot presents distances for </span><em><span>Clytia</span></em><span> cell types.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>(<span class="cm-variable">plotDf</span>[<span class="cm-variable">plotDf</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span> <span class="cm-operator">==</span> <span class="cm-string">'Cl'</span>,],<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">curatedIdentSub</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">dist</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">curatedIdentSub</span>)) <span class="cm-operator">+</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_boxplot</span>() <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#geom_jitter(height = 0, width = 0.1, size = 0.1,alpha=0.4) +</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme_bw</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme</span>(<span class="cm-variable">legend.position</span><span class="cm-operator">=</span><span class="cm-string">"none"</span>) <span class="cm-operator">+</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_flip</span>()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="resources/clDistBox.png" alt="clDistBox" style="zoom:25%;" /></p><h2 id='identifying-orthologous-genes-with-conserved-expression-patterns'><span>Identifying Orthologous Genes with Conserved Expression Patterns</span></h2><p><span>The alignment score we calculated above could be used to holistically examine transcriptional similarities, but it did not give us access to the genes whose expression patterns were conserved in </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span>. To identify genes with conserved expression patterns, we needed a way to correlate the expression patterns in </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span> cells. </span></p><p><span>To do this, we used a very high resolution Louvain clustering analysis to generate ad-hoc &#39;pseudo-cells&#39;. These pseudo-cells grouped together cells (regardless of species) that were close together in the aligned principal component space. We calculated average gene expression values in each species for each pseudo-cell and then, by matching pseudo-cell labels from each species, identified genes with similar expression patterns. </span></p><p><span>We started by first importing the Seurat object containing the aligned </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span> data and performing a high resolution Louvain clustering analysis. This generated a total of 132 &#39;pseudo-cell&#39; clusters.</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tidyverse</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rstudioapi</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">glmGamPoi</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">plotly</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">patchwork</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">plyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">SeuratDisk</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">cowplot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">gplots</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">viridis</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#utility to convert transcript ID to gene ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t2g</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vapply</span>(<span class="cm-variable">x</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">y</span>) <span class="cm-variable">gsub</span>(<span class="cm-string">'HVAEP1_T(</span><span class="cm-string-2">\\</span><span class="cm-string">d+)[.]</span><span class="cm-string-2">\\</span><span class="cm-string">d'</span>,<span class="cm-string">'HVAEP1-G</span><span class="cm-string-2">\\</span><span class="cm-string">1'</span>,<span class="cm-variable">y</span>),<span class="cm-string">""</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setwd</span>(<span class="cm-variable">dirname</span>(<span class="cm-variable">getActiveDocumentContext</span>()<span class="cm-operator cm-dollar">$</span><span class="cm-variable">path</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import integrated hydra and clytia seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">'aepClInt.rds'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#perform a high resolution louvain clustering analysis</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#this generates ad-hoc 'pseudo-cells' that group </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#together small groups of cells with similar expression</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(total of 132 clusters at this resolution)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">aepCl.int</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>, <span class="cm-variable">graph.name</span> <span class="cm-operator">=</span> <span class="cm-string">'integrated_snn'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#pseudo-cell UMAP</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 682px;"></div><div class="CodeMirror-gutters" style="display: none; height: 682px;"></div></div></div></pre><p><img src="resources/pseudoCellUMAP.png" referrerpolicy="no-referrer" alt="pseudoCellUMAP"></p><p><span>We then extracted the normalized read matrix from the Seurat object, split cells both by species and pseudo-cell ID, and calculated average read counts. We then calculated correlation scores for pseudo-cell expression when comparing the two species. We used the resulting scores as a readout of how conserved the cell-type-specificity was for a pair of </span><em><span>Clytia</span></em><span> and </span><em><span>Hydra</span></em><span> orthologs.</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#extract normalized expression data</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">t</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">aepCl.int</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">data</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#get the average expression of each gene, aggregated by both pseudo-cell ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#and species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat.cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aggregate</span>(<span class="cm-variable">expDat</span>,<span class="cm-builtin">list</span>(<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">seurat_clusters</span>,<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span>),<span class="cm-variable">mean</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#only keep the clusters that had cells from both species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat.cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">expDat.cl</span>[<span class="cm-variable">expDat.cl</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">expDat.cl</span>[<span class="cm-variable">expDat.cl</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span> <span class="cm-operator">==</span> <span class="cm-string">'Cl'</span>,<span class="cm-string">'Group.1'</span>],]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat.cl</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">expDat.cl</span>[<span class="cm-variable">expDat.cl</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">expDat.cl</span>[<span class="cm-variable">expDat.cl</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span> <span class="cm-operator">==</span> <span class="cm-string">'AEP'</span>,<span class="cm-string">'Group.1'</span>],]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">expDat.cl</span>,<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'pcExpression.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#split data by species (make an AEP df and a Clytia DF)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat.cl.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">split</span>(<span class="cm-variable">expDat.cl</span>,<span class="cm-variable">expDat.cl</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#droup group.1 and group.2 columns</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expDat.cl.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">expDat.cl.list</span>,<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">x</span>[,<span class="cm-variable">c</span>(<span class="cm-operator">-</span><span class="cm-number">1</span>,<span class="cm-operator">-</span><span class="cm-number">2</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#calculate the correlation in pseudocell expression patterns across</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#the two species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">ncol</span>(<span class="cm-variable">expDat.cl.list</span>[[<span class="cm-number">1</span>]]),<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">cor</span>(<span class="cm-variable">expDat.cl.list</span>[[<span class="cm-number">1</span>]][,<span class="cm-variable">x</span>],<span class="cm-variable">expDat.cl.list</span>[[<span class="cm-number">2</span>]][,<span class="cm-variable">x</span>],<span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-string">'pearson'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#generate DF of correlation scores for all genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">do.call</span>(<span class="cm-variable">c</span>,<span class="cm-variable">corRes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">expDat.cl.list</span>[[<span class="cm-number">1</span>]]),<span class="cm-variable">cor</span><span class="cm-operator">=</span><span class="cm-variable">corRes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#set NAs to 0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes</span>[<span class="cm-variable">is.na</span>(<span class="cm-variable">corRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span>),<span class="cm-string">'cor'</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#order by correlation score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">corRes</span>[<span class="cm-variable">order</span>(<span class="cm-operator">-</span><span class="cm-variable">corRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">corRes</span>,<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'geneCoreRes.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 880px;"></div><div class="CodeMirror-gutters" style="display: none; height: 880px;"></div></div></div></pre><p><span>For identifying conserved expression patterns, we used high resolution clusters, which allowed us to perform a relatively more refined comparison of expression in the two species. To visualize these conserved expression patterns, we opted to use a gene-by-cell-type heatmap. In order to avoid having a high number of columns (cell types) in the heatmap, thus improving overall readability, we used a lower resolution clustering to summarize the data. We generated descriptive labels for these lower resolution clusters based on the identities of both the </span><em><span>Hydra</span></em><span> and </span><em><span>Clytia</span></em><span> cells making up each cluster, although we showed some preference for labels based on </span><em><span>Hydra</span></em><span> annotations as </span><em><span>Hydra</span></em><span> cell types are generally better characterized.</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#after identifying genes with similar expression patterns</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#convey the data using a heatmap based on a lower resolution clustering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#otherwise it's just an insane number of columns</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import more descriptive names for lower resolution clusters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corPlotLabels</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.csv</span>(<span class="cm-string">'corPlotClustsLables.csv'</span>,<span class="cm-variable">header</span><span class="cm-operator">=</span><span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#make umap with descriptive names for clusters used for heatmap plots</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">renameClust</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">integrated_snn_res.0.4</span>,<span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">corPlotLabels</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V1</span>, <span class="cm-variable">corPlotLabels</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V2</span>, <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">aepCl.int</span>,<span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">'renameClust'</span>,<span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>() <span class="cm-operator">+</span> <span class="cm-variable">NoAxes</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><img src="resources/corPlotClusts.png" referrerpolicy="no-referrer" alt="corPlotClusts"></p><p><span>Using these broader clusters we again averaged gene expression by clusters (split by species) to generate the values that would populate the heatmap plot. We restricted these heatmaps to only those ortholog pairs with high correlation values (correlation score &gt; 0.65)</span></p><p><span>We first plotted the </span><em><span>Hydra</span></em><span> data:</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#generate averaged expression data for lower resolution clustering</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aggregate</span>(<span class="cm-variable">expDat</span>,<span class="cm-builtin">list</span>(<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">integrated_snn_res.0.4</span>,<span class="cm-variable">aepCl.int</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">species</span>),<span class="cm-variable">mean</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj</span>[<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">heatObj</span>[<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span> <span class="cm-operator">==</span> <span class="cm-string">'Cl'</span>,<span class="cm-string">'Group.1'</span>],]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj</span>[<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">heatObj</span>[<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span> <span class="cm-operator">==</span> <span class="cm-string">'AEP'</span>,<span class="cm-string">'Group.1'</span>],]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#bring in the descriptive cluster names</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">from</span><span class="cm-operator">=</span><span class="cm-variable">corPlotLabels</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">to</span><span class="cm-operator">=</span><span class="cm-variable">corPlotLabels</span>[,<span class="cm-number">2</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#split by species</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">split</span>(<span class="cm-variable">heatObj</span>,<span class="cm-variable">heatObj</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Group.2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#drop group.1 and group.2 columns</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">heatObj.list</span>,<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">rownames</span>(<span class="cm-variable">x</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">x</span>[,<span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">x</span>[,<span class="cm-variable">c</span>(<span class="cm-operator">-</span><span class="cm-number">1</span>,<span class="cm-operator">-</span><span class="cm-number">2</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#get data for AEP heatmap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.list</span>[[<span class="cm-number">1</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#only plot genes with high correlation scores</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.1</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">heatObj.1</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">corRes</span>[<span class="cm-variable">corRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.65</span>,<span class="cm-string">'id'</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#import table that specifies a reasonably logical way of ordering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#the heatmap columns (cell clusters)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corPloOrder</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.csv</span>(<span class="cm-string">'corPlotClustsOrder.csv'</span>,<span class="cm-variable">header</span><span class="cm-operator">=</span><span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.1</span>[<span class="cm-variable">corPloOrder</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V2</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdf</span>(<span class="cm-string">'heat1.pdf'</span>,<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">40</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#plot heatmap, save the output, which specifies how rows are ordered</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#which is needed to keep the clytia heatmap consistent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dgm</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatmap.2</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">scale</span> <span class="cm-operator">=</span> <span class="cm-string">'row'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dendrogram</span> <span class="cm-operator">=</span> <span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Colv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">col</span> <span class="cm-operator">=</span> <span class="cm-variable">viridis</span>(<span class="cm-number">30</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">trace</span><span class="cm-operator">=</span><span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">keysize</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">margins</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">10</span>,<span class="cm-number">6</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">distfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">as.dist</span>(<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">cor</span>(<span class="cm-variable">t</span>(<span class="cm-variable">x</span>))),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">hclustfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">hclust</span>(<span class="cm-variable">x</span>, <span class="cm-variable">method</span><span class="cm-operator">=</span><span class="cm-string">"average"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dev.off</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.1</span>),<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'crossSpecMatHydra.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1122px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1122px;"></div></div></div></pre><p><img src="resources/aepAllHeat.png" alt="aepAllHeat" style="zoom:25%;" /></p><p><span>We then plotted the </span><em><span>Clytia</span></em><span> data</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#extract clytia heatmap data</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.list</span>[[<span class="cm-number">2</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#keep only genes with good correlation scores</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.2</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">heatObj.2</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">corRes</span>[<span class="cm-variable">corRes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.65</span>,<span class="cm-string">'id'</span>]]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#reorder data to have the same order as the AEP matrix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.2</span>[<span class="cm-variable">rev</span>(<span class="cm-variable">dgm</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">rowInd</span>),<span class="cm-variable">corPloOrder</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V2</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#change gene names back to original clytia ortho name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">'../../Orthofinder/Results_Sep15_1/Phylogenetic_Hierarchical_Orthogroups/N14.tsv'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[,<span class="cm-variable">c</span>(<span class="cm-string">'C_hemisphaerica'</span>,<span class="cm-string">'H_vulgarisAEP'</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span> <span class="cm-operator">!=</span> <span class="cm-string">''</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span> <span class="cm-operator">!=</span> <span class="cm-string">''</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orthos</span>[<span class="cm-operator">!</span>(<span class="cm-variable">grepl</span>(<span class="cm-string">','</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>) <span class="cm-operator">|</span> <span class="cm-variable">grepl</span>(<span class="cm-string">','</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>)),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">gsub</span>(<span class="cm-string">'HVAEP1_T(</span><span class="cm-string-2">\\</span><span class="cm-string">d+)[.].*'</span>,<span class="cm-string">'HVAEP1-G</span><span class="cm-string-2">\\</span><span class="cm-string">1'</span>,<span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">heatObj.2</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">rownames</span>(<span class="cm-variable">heatObj.2</span>), <span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>, <span class="cm-variable">to</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>,<span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#plot clytia heatmap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdf</span>(<span class="cm-string">'heat2.pdf'</span>,<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">40</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatmap.2</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">heatObj.2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Rowv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Colv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span> <span class="cm-operator">=</span> <span class="cm-string">'row'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dendrogram</span> <span class="cm-operator">=</span> <span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">col</span> <span class="cm-operator">=</span> <span class="cm-variable">magma</span>(<span class="cm-number">30</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">trace</span><span class="cm-operator">=</span><span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">keysize</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">margins</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">10</span>,<span class="cm-number">6</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">distfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">as.dist</span>(<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">cor</span>(<span class="cm-variable">t</span>(<span class="cm-variable">x</span>))),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hclustfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">hclust</span>(<span class="cm-variable">x</span>, <span class="cm-variable">method</span><span class="cm-operator">=</span><span class="cm-string">"average"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dev.off</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.2</span>),<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'crossSpecMatClytia.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 880px;"></div><div class="CodeMirror-gutters" style="display: none; height: 880px;"></div></div></div></pre><p><img src="resources/clAllHeat.png" alt="clAllHeat" style="zoom:25%;" /></p><p><span>We also generated a table including correlation scores for all high scoring (correlation score &gt; 0.65) ortholog pairs as well as functional annotations (putative vertebrate orthologs, protein domains, etc.)</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#generate table of correlation scores for export (only high scoring genes)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#bring in functional annotation information to make browsing results easier to interpret</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annots</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.csv</span>(<span class="cm-string">'../../Orthofinder/HVAEP1_annotation.csv'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">annots</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">t2g</span>(<span class="cm-variable">annots</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes.annot</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">merge</span>(<span class="cm-variable">corRes</span>,<span class="cm-variable">annots</span>,<span class="cm-variable">by.x</span> <span class="cm-operator">=</span> <span class="cm-string">'id'</span>, <span class="cm-variable">by.y</span> <span class="cm-operator">=</span> <span class="cm-string">'H_vulgarisAEP'</span>, <span class="cm-variable">all.x</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes.annot</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">corRes.annot</span>[<span class="cm-variable">order</span>(<span class="cm-operator">-</span><span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes.annot</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">corRes.annot</span>[<span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.65</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">clOrtho</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">mapvalues</span>(<span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span>, <span class="cm-variable">from</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">H_vulgarisAEP</span>, <span class="cm-variable">to</span> <span class="cm-operator">=</span> <span class="cm-variable">orthos</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">C_hemisphaerica</span>, <span class="cm-variable">warn_missing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">corRes.annot</span>,<span class="cm-string">'crossSpecExpCor.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>Finally, we generated another set of heat maps that included only putative transcription factors (predictions were based on interproscan results as described in </span><code>03_aepGenomeAnnotation.md</code><span>). First for AEP:</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#subset correlation heatmap to just look at trancription factors</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tfList</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">'../../Genome_annotation/functionalAnnotation/tfIDs.txt'</span>,<span class="cm-variable">header</span><span class="cm-operator">=</span><span class="cm-variable">F</span>)[,<span class="cm-number">1</span>,<span class="cm-variable">drop</span><span class="cm-operator">=</span><span class="cm-variable">T</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tfList</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">gsub</span>(<span class="cm-string">'_'</span>,<span class="cm-string">'-'</span>,<span class="cm-variable">tfList</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.list</span>[[<span class="cm-number">1</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.1</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">heatObj.1</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">corRes.annot</span>[<span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.65</span>,<span class="cm-string">'id'</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.1</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">heatObj.1</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">tfList</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.1</span>[<span class="cm-variable">corPloOrder</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V2</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdf</span>(<span class="cm-string">'tfHeat1.pdf'</span>,<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dgm</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatmap.2</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">scale</span> <span class="cm-operator">=</span> <span class="cm-string">'row'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Colv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dendrogram</span> <span class="cm-operator">=</span> <span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">col</span> <span class="cm-operator">=</span> <span class="cm-variable">viridis</span>(<span class="cm-number">30</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">trace</span><span class="cm-operator">=</span><span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">keysize</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">margins</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">5</span>,<span class="cm-number">10</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">distfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">as.dist</span>(<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">cor</span>(<span class="cm-variable">t</span>(<span class="cm-variable">x</span>))),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">hclustfun</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">hclust</span>(<span class="cm-variable">x</span>, <span class="cm-variable">method</span><span class="cm-operator">=</span><span class="cm-string">"average"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dev.off</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.1</span>),<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'crossSpecTfMatHydra.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 616px;"></div><div class="CodeMirror-gutters" style="display: none; height: 616px;"></div></div></div></pre><p><img src="resources/aepTfHeat.png" referrerpolicy="no-referrer" alt="aepTfHeat"></p><p><span>Then for </span><em><span>Clytia</span></em><span>:</span></p><p><span>(</span><em><span>03_expressionConservation/aepCl_Cor.R</span></em><span>)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.list</span>[[<span class="cm-number">2</span>]]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.2</span>[,<span class="cm-variable">colnames</span>(<span class="cm-variable">heatObj.2</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">corRes.annot</span>[<span class="cm-variable">corRes.annot</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cor</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.65</span>,<span class="cm-string">'id'</span>]]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.2</span>[<span class="cm-variable">rownames</span>(<span class="cm-variable">heatObj.2</span>) <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">tfList</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatObj.2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">heatObj.2</span>[<span class="cm-variable">rev</span>(<span class="cm-variable">dgm</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">rowInd</span>),<span class="cm-variable">corPloOrder</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">V2</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdf</span>(<span class="cm-string">'tfHeat2.pdf'</span>,<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">heatmap.2</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">heatObj.2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Rowv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Colv</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span> <span class="cm-operator">=</span> <span class="cm-string">'row'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dendrogram</span> <span class="cm-operator">=</span> <span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">col</span> <span class="cm-operator">=</span> <span class="cm-variable">magma</span>(<span class="cm-number">30</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">trace</span><span class="cm-operator">=</span><span class="cm-string">'none'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">keysize</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">margins</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">5</span>,<span class="cm-number">10</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dev.off</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">heatObj.2</span>),<span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-string">'crossSpecTfMatClytia.csv'</span>,<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p><img src="resources/clTfHeat.png" referrerpolicy="no-referrer" alt="clTfHeat"></p><p>&nbsp;</p><h2 id='files-associated-with-this-document'><span>Files Associated with This Document</span></h2><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">12_crossSpeciesAtlasAlignment/</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── 01_alignment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── aepClInt.rds</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>R binary file containing the aligned Hydra and Clytia single-cell atlases</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>formatted as a Seurat object.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; └── aepCl.R</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>R script that aligns the Clytia and Hydra single-cell atlases and quantifies</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>and visualizes transcriptional similarities across homologous cell types using </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>a mutual nearest neighbor-based alignment score.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── 02_similarityQuant</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── aepClIntNeuroLab.rds</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>R binary file containing a modified version of aepClInt.rds that includes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>neuronal subtype annotations from the original Clytia atlas publication.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── crossSpecDist.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table that provides the average distance to the 30 nearest cross-species</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>nearest neighbors for every cell in the cross-species atlas. The table</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>also includes the barcode and the curated cell type annotation for each</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>cell.</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── mnnRes.csv</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table that lists the mutual nearest cross-species neighbors for all cells</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>in the aligned Clytia and Hydra atlas.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; ├── mnnSankeyLink.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table used for generating a sankey plot visualizing the alignment scores generated</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>by systematically comparing Clytia and Hydra cell types in the aligned cross-species</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>single-cell atlas. The table includes all cross-species cell type pairs that had an</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>alignment score ≥ 0.05. In addition to specifying the two cell types, it also includes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>the alignment score under the 'value' column.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">│&nbsp;&nbsp; └── mnnSankeyNode.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table used for generating a sankey plot visualizing the alignment scores generated</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>by systematically comparing Clytia and Hydra cell types in the aligned cross-species</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>single-cell atlas. This table simply lists all cell types included in the alignment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  score sankey plot (required by the function that made the plot).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">└── 03_expressionConservation</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── aepCl_Cor.R</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>R script that identifies genes with conserved expression patterns in the cross-</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>species atlas and visualizes the results using heatmaps.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── corPlotClustsLables.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing descriptive names for the Louvain clusters in the cross-species</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  atlas used for generating the heatmaps visualizing conserved expression patterns.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── corPlotClustsOrder.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table that specifies the order that the clusters listed in corPlotClustsLables.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>will be displayed in the heatmaps visualizing conserved expression patterns.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── crossSpecExpCor.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table listing all genes with a cross-species expression correlation score above 0.65.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>The table also includes functional annotation data for each gene.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── crossSpecMatClytia.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the values used to generate the heatmap depicting the expression </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>patterns of all Clytia genes with a cross-species expression correlation score </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>above 0.65.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── crossSpecMatHydra.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the values used to generate the heatmap depicting the expression </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>patterns of all Hydra genes with a cross-species expression correlation score </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>above 0.65.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── crossSpecTfMatClytia.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the values used to generate the heatmap depicting the expression </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>patterns of all Clytia transcription factors with a cross-species expression </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>correlation score above 0.65.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── crossSpecTfMatHydra.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the values used to generate the heatmap depicting the expression</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  patterns of all Hydra transcription factors with a cross-species expression </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  correlation score above 0.65.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ├── geneCoreRes.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the cross-species expression correlation scores for all genes in </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>the cross-species atlas.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  └── pcCellIDs.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>Table containing the pseudo-cell assignments for all cells in the cross-species </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>atlas.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1474px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1474px;"></div></div></div></pre><p>&nbsp;</p></div></div>
</body>
</html>